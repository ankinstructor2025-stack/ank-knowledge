<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QAメンテ（契約選択 / 対話データ / QA作成）</title>
  <style>
    :root { --border:#e5e7eb; --muted:#6b7280; --bg:#f9fafb; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; background: #fff; }
    .layout { display:flex; height: 100vh; }
    .left  { width: 320px; border-right:1px solid var(--border); padding:16px; box-sizing:border-box; background: #fff; }
    .right { flex:1; padding:16px; box-sizing:border-box; background: var(--bg); overflow:auto; }

    .panel { background:#fff; border:1px solid var(--border); border-radius:12px; padding:14px; }
    .h { font-weight:700; margin:0 0 8px; }
    .muted { color:var(--muted); font-size:12px; }

    .contract-list { margin-top:10px; display:flex; flex-direction:column; gap:8px; }
    .contract-item { border:1px solid var(--border); border-radius:10px; padding:10px; cursor:pointer; background:#fff; }
    .contract-item:hover { background:#f8fafc; }
    .contract-item.selected { border-color:#111827; box-shadow:0 0 0 1px #111827 inset; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .badge { font-size:12px; padding:2px 8px; border:1px solid var(--border); border-radius:999px; color:#111827; background:#fff; }
    .spacer { height:10px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }

    input[type="text"], textarea, select {
      width:100%; box-sizing:border-box; padding:10px; border:1px solid var(--border);
      border-radius:10px; background:#fff; font-size:14px;
    }
    textarea { min-height: 120px; resize: vertical; }
    button {
      padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#111827;
      color:#fff; cursor:pointer; font-weight:600;
    }
    button.secondary { background:#fff; color:#111827; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .hr { height:1px; background:var(--border); margin:12px 0; }
    .log { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
           font-size:12px; background:#0b1020; color:#e5e7eb; padding:10px; border-radius:10px; overflow:auto; }

    .warn { color:#b45309; font-size:12px; }

    /* 対話データ一覧 */
    .list { display:flex; flex-direction:column; gap:8px; }
    .item { border:1px solid var(--border); border-radius:10px; padding:10px; background:#fff; }
    .item.selected { border-color:#111827; box-shadow:0 0 0 1px #111827 inset; }
    .item-top { display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
    .radio { display:flex; align-items:center; gap:8px; }
    .small { font-size:12px; color:var(--muted); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

    /* ファイルエラー表示 */
    .file-error {
      display:none;
      margin-top:6px;
      color:#b91c1c;
      font-size:12px;
      font-weight:600;
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- LEFT -->
    <aside class="left">
      <div class="panel">
        <p class="h">契約一覧</p>
        <div class="row">
          <button id="reloadContractsBtn" class="secondary" type="button">再読込</button>
          <span id="contractCount" class="muted"></span>
        </div>
        <div class="spacer"></div>
        <div id="contracts" class="contract-list"></div>
        <div class="spacer"></div>
        <div class="muted">role=admin かつ active の契約のみ表示</div>
      </div>
    </aside>

    <!-- RIGHT -->
    <main class="right">
      <div class="panel">
        <p class="h">QAメンテ</p>
        <div class="muted">左の契約を選ぶと、右側の操作が有効になる想定</div>

        <div class="hr"></div>

        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="muted">選択中の契約</div>
            <div class="row" style="gap:8px;">
              <span id="selectedContractName" class="badge">未選択</span>
              <span id="selectedContractId" class="muted"></span>
            </div>
          </div>
          <div class="warn" id="notSelectedMsg">契約を選ぶと操作が有効になります</div>
        </div>

        <!-- ① 対話データアップロード -->
        <div class="hr"></div>
        <p class="h" style="margin-top:0;">対話データを追加</p>
        <div class="muted">アップロード後、下の一覧から「QA作成に使う対話データ」を1つ選択します</div>

        <div class="spacer"></div>

        <div class="grid">
          <div>
            <div class="muted">アップロード種別</div>
            <select id="uploadKind" disabled>
              <option value="dialogue">対話データ</option>
              <option value="qa_csv">QA CSV</option>
              <option value="other">その他</option>
            </select>
          </div>
          <div>
            <div class="muted">メモ（任意）</div>
            <input id="uploadNote" type="text" placeholder="例：2026-01 追加分" disabled />
          </div>
        </div>

        <div class="spacer"></div>

        <div>
          <div class="muted">ファイル</div>
          <input id="fileInput" type="file" accept=".txt,.json,.csv" disabled />
          <div class="muted" style="margin-top:6px;">例：.txt / .json / .csv（1KB〜100MB）</div>

          <div id="fileError" class="file-error"></div>
        </div>

        <div class="spacer"></div>

        <div class="row" style="gap:10px;">
          <button id="uploadBtn" type="button" disabled>アップロード</button>
          <button id="dryRunBtn" class="secondary" type="button" disabled>ドライラン（API呼び出し内容を表示）</button>

          <div style="flex:1;"></div>
          <button id="reloadDialoguesBtn" class="secondary" type="button" disabled>対話データ一覧 再読込</button>
        </div>

        <!-- ② 対話データ一覧（1つ選択） -->
        <div class="hr"></div>
        <p class="h" style="margin-top:0;">対話データ一覧</p>
        <div class="muted">QA作成に使う対話データを1つ選択します</div>

        <div class="spacer"></div>
        <div id="dialoguesEmpty" class="muted">（対話データがありません）</div>
        <div id="dialogues" class="list"></div>

        <div class="spacer"></div>

        <div class="row">
          <span id="selectedDialogueLabel" class="muted"></span>
        </div>

        <!-- ③ QA作成 -->
        <div class="hr"></div>
        <p class="h" style="margin-top:0;">QA作成</p>
        <div class="muted">選択中の対話データに対してQA作成を開始します</div>

        <div class="spacer"></div>
        <div class="row">
          <button id="buildQaBtn" type="button" disabled>QA作成</button>
          <span class="muted">※ 進捗は後で追加（まずは開始できればOK）</span>
        </div>

        <div class="hr"></div>
        <div class="muted">ログ</div>
        <pre id="log" class="log"></pre>
      </div>
    </main>
  </div>

  <script type="module" src="./qa_maintenance.js"></script>
</body>
</html>
